{% extends 'themes/base_visitor.html.twig' %}

{% block title %}{{post.title}}{% endblock %}

{% block description %}{{post.description}}{% endblock %}

{% block keywords %}
    {% if post.keywords %}
        <meta name="keywords" content="{{post.keywords}}">
    {% endif %}
{% endblock %}

{% block main %}

    <div class="container">
        <div class="row">
            <div class="col-md-10 col-lg-8 mx-auto my-5">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="{{path('app_visitor_blog_index')}}">Liste des articles</a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{post.title|u.truncate('60','...')}}</li>
                    </ol>
                </nav>

                <div class="text-center">
                    {% if post.image %}
                        <img class="img-fluid rounded" src="{{ vich_uploader_asset(post, 'imageFile') }}" alt="{{ post.title }}">
                    {% endif %}

                    <h1 class="my-3 display-6">{{post.title}}</h1>

                    <small>Publié {{post.publishedAt|ago}} par
                        {% if post.user %}
                            <strong>{{post.user.firstName}} {{post.user.lastName}}</strong>
                        {% else %}
                            <strong>Jean Dupont</strong>
                        {% endif %}
                    </small>
                </div>

                <div class="my-5">
                    {{post.content|raw}}
                </div>

                <hr>
                <div>
                    {% if app.user %}
                        {# Form #}
                        {{form_start(commentForm, {'action': path('app_visitor_blog_post_show', {'id':post.id, 'slug':post.slug})~'#comments-container'})}}
                            <div class="mb-3">
                                <label for="comment_form_content" class="h2">Laissez un commentaire</label>
                                <div class="text-danger">{{form_errors(commentForm.content)}}</div>
                                {{form_widget(commentForm.content, {'attr': {'class':'form-control', 'rows':4}})}}
                            </div>
                            <div>
                                <input formnovalidate type="submit" class="btn btn-primary shadow" value="Commenter">
                            </div>
                        {{form_end(commentForm)}}
                    {% else %}
                        <p><strong>Veuillez vous connecter afin de laisser un commentaire:</strong> <a href="{{path('app_login')}}" class="btn btn-lg btn-outline-primary">Se connecter</a></p>
                    {% endif %}              
                </div>
                <hr>


                <div id="comments-container">
                    {% if post.comments is not empty %}
                        <h2>Liste des commentaires</h2>
                        {% for comment in post.comments|reverse %}
                            {% if comment.isActivated %}
                                <div class="shadow p-3 my-4 rounded">
                                    <p>
                                        <strong>{{comment.user.firstName}} {{comment.user.lastName}}</strong>
                                        <small>Publié {{comment.createdAt|ago}}</small>                                
                                    </p>
                                    <div>
                                        {{comment.content}}
                                    </div>
                                </div>
                            {% endif %}
                        {% endfor %}
                    {% endif %}
                </div>

        
            </div>
        </div>
    </div>

{% endblock %}